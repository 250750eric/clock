<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GPS 氣象鐘 Pro</title>
    <style>
        body { background-color: black; color: #FF8C00; font-family: 'Arial', sans-serif; margin: 0; overflow: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; }
        #date-lunar { font-size: 5vw; margin-bottom: 10px; }
        #clock-box { display: flex; align-items: center; justify-content: center; font-weight: bold; }
        #time-main { font-size: 28vw; line-height: 1; }
        #colon { font-size: 20vw; width: 5vw; text-align: center; padding-bottom: 2vw; }
        #sec-box { font-size: 10vw; width: 12vw; align-self: flex-end; margin-bottom: 3vw; margin-left: 10px; }
        #weather { font-size: 6vw; margin-top: 20px; color: #00FF00; }
        #chime-btn { position: absolute; bottom: 30px; right: 30px; width: 65px; height: 65px; border: 2px solid #FF8C00; background: rgba(255, 140, 0, 0.1); color: #FF8C00; border-radius: 12px; display: flex; justify-content: center; align-items: center; font-size: 14px; font-weight: bold; cursor: pointer; text-align: center; line-height: 1.2; }
        #chime-btn.active { background: rgba(255, 140, 0, 0.5); color: white; }
    </style>
</head>
<body onclick="startAudioService()">

    <div id="date-lunar">載入中...</div>
    <div id="clock-box">
        <div id="time-main">00:00</div>
        <div id="colon">:</div>
        <div id="sec-box">00</div>
    </div>
    <div id="weather">台中 定位中...</div>

    <div id="chime-btn" class="active" onclick="toggleChime(event)">報時<br>ON</div>

    <script>
        let isChimeEnabled = true;
        let lastHour = -1;
        let audioStarted = false;

        // 啟動語音服務
        function startAudioService() {
            if (audioStarted) return;
            const msg = new SpeechSynthesisUtterance("語音報時服務已啟動");
            msg.lang = 'zh-TW';
            window.speechSynthesis.speak(msg);
            audioStarted = true;
        }

        // 農曆轉換邏輯
        function updateDate() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            const solar = now.toLocaleDateString('zh-TW', options);
            const lunar = new Intl.DateTimeFormat('zh-TW-u-ca-chinese', {day:'numeric', month:'long'}).format(now);
            document.getElementById('date-lunar').innerText = `${solar} 農曆${lunar}`;
        }

        function toggleChime(e) {
            e.stopPropagation();
            isChimeEnabled = !isChimeEnabled;
            const btn = document.getElementById('chime-btn');
            btn.innerHTML = isChimeEnabled ? "報時<br>ON" : "報時<br>OFF";
            btn.classList.toggle('active');
            const msg = new SpeechSynthesisUtterance(isChimeEnabled ? "開啟報時" : "關閉報時");
            msg.lang = 'zh-TW';
            window.speechSynthesis.speak(msg);
        }

        function announce(hour) {
            if (!isChimeEnabled || hour < 7 || hour >= 23) return;
            const weather = document.getElementById('weather').innerText;
            const msg = new SpeechSynthesisUtterance(`現在時間${hour}點整。${weather}`);
            msg.lang = 'zh-TW';
            window.speechSynthesis.speak(msg);
        }

        function updateClock() {
            const now = new Date();
            const h = now.getHours();
            const m = String(now.getMinutes()).padStart(2, '0');
            const s = String(now.getSeconds()).padStart(2, '0');

            document.getElementById('time-main').innerText = `${h}:${m}`;
            document.getElementById('sec-box').innerText = s;
            document.getElementById('colon').style.visibility = (now.getSeconds() % 2 === 0) ? "visible" : "hidden";

            if (now.getMinutes() === 0 && now.getSeconds() === 0 && h !== lastHour) {
                announce(h);
                lastHour = h;
            }
            if (s === "00") updateDate();
        }

        function updateLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    document.getElementById('weather').innerText = "台中 多雲 27°C";
                });
            }
        }

        setInterval(updateClock, 1000);
        updateClock();
        updateDate();
        updateLocation();
    </script>
</body>
</html>
